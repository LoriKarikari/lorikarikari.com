---
import { getCollection } from "astro:content";
import Layout from "@layouts/Layout.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import LinkButton from "@components/LinkButton.astro";
import Card from "@components/Card";
import Socials from "@components/Socials.astro";
import getSortedPosts from "@utils/getSortedPosts";
import slugify from "@utils/slugify";
import { SOCIALS } from "@config";

const posts = await getCollection("blog");

const sortedPosts = getSortedPosts(posts);
const featuredPosts = sortedPosts.filter(({ data }) => data.featured);

const socialCount = SOCIALS.filter(social => social.active).length;
---

<Layout>
	<Header />
	<main id="main-content">
		<section
			class="pb-6 pt-8 bg-[#F6DFD5] max-w-3xl mx-50"
		>
			<h1 class="my-4 inline-block text-3xl font-bold sm:my-8 sm:text-5xl text-[#414564]">Hallo!</h1>
			<a
				target="_blank"
				href="/rss.xml"
				class="mb-6"
				aria-label="rss feed"
				title="RSS Feed"
			>
				<svg xmlns="http://www.w3.org/2000/svg" class="mb-2 h-6 w-6 scale-110 fill-[#DE8379] sm:mb-3 sm:scale-125"
					><path
						d="M19 20.001C19 11.729 12.271 5 4 5v2c7.168 0 13 5.832 13 13.001h2z"
					></path><path
						d="M12 20.001h2C14 14.486 9.514 10 4 10v2c4.411 0 8 3.589 8 8.001z"
					></path><circle cx="6" cy="18" r="2"></circle>
				</svg>
			</a>

			<p class="my-2 text-[#776062]">
				Welcome to my personal blog! 
				Here, I'll be sharing my experiences as I delve into the world of web development, cloud infrastructure and a bunch of other things that I am interested in.
				This includes languages like Go and TypeScript, building side projects, and cloud services like AWS.
			</p>
	
			{
				// only display if at least one social link is enabled
				socialCount > 0 && (
					<div class="mt-4 flex flex-col sm:flex-row sm:items-center">
						<div class="mb-1 mr-2 whitespace-nowrap sm:mb-0 text-[#776062]">Social Links:</div>
						<Socials />
					</div>
				)
			}
		</section>

		{
			featuredPosts.length > 0 && (
				<>
					<section class=" pb-6 pt-12 bg-[#F6DFD5]">
						<h2 class="text-2xl font-semibold tracking-wide"><span class=" bg-[#DE8379] text-white p-2">Featured</span></h2>
						<ul>
							{featuredPosts.map(({ data }) => (
								<Card
									href={`/posts/${slugify(data)}`}
									frontmatter={data}
									secHeading={false}
								/>
							))}
						</ul>
					</section>
				</>
			)
		}
		<section class="pb-6 pt-8  bg-[#F6DFD5]">
			<h2 class="text-2xl font-semibold tracking-wide"><span class=" bg-[#DE8379] text-white p-2">Recent posts</span></h2>
			<ul>
				{
					sortedPosts.map(
						({ data }, index) =>
							index < 4 && (
								<Card
									href={`/posts/${slugify(data)}`}
									frontmatter={data}
									secHeading={false}
								/>
							)
					)
				}
			</ul>
			<div class="my-8 text-center">
				<LinkButton href="/posts">
					All Posts
					<svg xmlns="http://www.w3.org/2000/svg"
						><path
							d="m11.293 17.293 1.414 1.414L19.414 12l-6.707-6.707-1.414 1.414L15.586 11H6v2h9.586z"
						></path>
					</svg>
				</LinkButton>
			</div>
		</section>
	</main>
	<Footer />
</Layout>
